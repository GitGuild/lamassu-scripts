#!/usr/bin/env bash
set -e

BIN=$(npm bin)
LOG_FILE=/tmp/install.log

SEED=$(cat /opt/apps/seeds/seed.txt)
PASS_FILE=/opt/apps/seeds/geth.txt
$BIN/hkdf geth-pw $SEED > $PASS_FILE
ACCOUNT_STR=$(geth --password $PASS_FILE account new)
ACCOUNT=$(echo $ACCOUNT_STR | grep -o '{.*}' | tr -d '{}')

ufw allow 30303/tcp >> $LOG_FILE 2>&1 # Ethereum
pm2 start geth -- --fast --rpc --unlock $ACCOUNT --password $PASS_FILE >> $LOG_FILE 2>&1

echo "Success. Your main account is 0x$ACCOUNT."
